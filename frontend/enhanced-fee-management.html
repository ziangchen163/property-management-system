<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©ä¸šç®¡ç†ç³»ç»Ÿ v2.0 - å¢å¼ºç‰ˆæ”¶è´¹ç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .tab-button:hover {
            background: #f8f9fa;
        }
        
        .tab-button.active {
            background: #667eea;
            color: white;
            border-bottom-color: #4c63d2;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #48bb78;
        }
        
        .btn-success:hover {
            background: #38a169;
        }
        
        .btn-warning {
            background: #ed8936;
        }
        
        .btn-warning:hover {
            background: #dd7724;
        }
        
        .btn-danger {
            background: #f56565;
        }
        
        .btn-danger:hover {
            background: #e53e3e;
        }
        
        .result-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 20px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .result-box pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-card h4 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .stat-card p {
            color: #666;
            font-size: 1.1em;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #667eea;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        .table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: 500;
            border-radius: 4px;
            text-transform: uppercase;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¢ ç‰©ä¸šç®¡ç†ç³»ç»Ÿ v2.0</h1>
            <p>å¢å¼ºç‰ˆæ”¶è´¹ç®¡ç†ç³»ç»Ÿ - æ”¯æŒå¤šå°åŒºã€ç²¾ç¡®è®¡è´¹ã€è‡ªåŠ¨æ¬ è´¹è®¡ç®—</p>
        </div>
        
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('overview')">ç³»ç»Ÿæ¦‚è§ˆ</button>
            <button class="tab-button" onclick="switchTab('communities')">å°åŒºç®¡ç†</button>
            <button class="tab-button" onclick="switchTab('fee-calculation')">æ¬ è´¹è®¡ç®—</button>
            <button class="tab-button" onclick="switchTab('bill-generation')">è´¦å•ç”Ÿæˆ</button>
            <button class="tab-button" onclick="switchTab('utilities')">æ°´ç”µç®¡ç†</button>
            <button class="tab-button" onclick="switchTab('daily-income')">æ¯æ—¥æ”¶å…¥</button>
            <button class="tab-button" onclick="switchTab('deposits')">æŠ¼é‡‘ç®¡ç†</button>
        </div>
        
        <!-- ç³»ç»Ÿæ¦‚è§ˆ -->
        <div id="overview" class="tab-content active">
            <h2>ğŸ¯ ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>å¤šå°åŒºç®¡ç†</h4>
                    <p>æ”¯æŒç®¡ç†å¤šä¸ªå°åŒºï¼Œæ¯ä¸ªå°åŒºç‹¬ç«‹é…ç½®æ”¶è´¹æ ‡å‡†</p>
                </div>
                <div class="stat-card">
                    <h4>ç²¾ç¡®è®¡è´¹</h4>
                    <p>æ ¹æ®æˆ¿äº§æ€§è´¨ã€è½¦ä½ç±»å‹è‡ªåŠ¨è®¡ç®—å‡†ç¡®è´¹ç”¨</p>
                </div>
                <div class="stat-card">
                    <h4>è‡ªåŠ¨æ¬ è´¹</h4>
                    <p>åŸºäºäº¤ä»˜æ—¶é—´è‡ªåŠ¨è®¡ç®—ä¸šä¸»æ‰€æœ‰æ¬ è´¹é¡¹ç›®</p>
                </div>
                <div class="stat-card">
                    <h4>æŠ¼é‡‘ç®¡ç†</h4>
                    <p>æ”¯æŒæ°´è´¹æŠ¼é‡‘ã€è£…ä¿®æŠ¼é‡‘ï¼Œå¯è‡ªåŠ¨æ‰£è´¹</p>
                </div>
            </div>
            
            <div class="card">
                <h3>ğŸš€ æ–°ç‰ˆæœ¬ç‰¹æ€§</h3>
                <ul style="margin-left: 20px; line-height: 2;">
                    <li><strong>å¤šå°åŒºæ”¯æŒ</strong>ï¼šä¸€å¥—ç³»ç»Ÿç®¡ç†å¤šä¸ªå°åŒºï¼Œæ¯ä¸ªå°åŒºç‹¬ç«‹é…ç½®</li>
                    <li><strong>æˆ¿äº§æ€§è´¨ç®¡ç†</strong>ï¼šæ”¯æŒæ™®é€šä½å®…ã€å…¬å¯“ã€å•†é“ºã€åˆ«å¢…ç­‰ä¸åŒæ”¶è´¹æ ‡å‡†</li>
                    <li><strong>è½¦ä½ç±»å‹ç®¡ç†</strong>ï¼šåœ°ä¸Šã€åœ°ä¸‹ã€ç«‹ä½“è½¦åº“ç­‰ä¸åŒç®¡ç†è´¹</li>
                    <li><strong>æ™ºèƒ½æ¬ è´¹è®¡ç®—</strong>ï¼šä»äº¤ä»˜æ—¥æœŸå¼€å§‹ï¼Œè‡ªåŠ¨è®¡ç®—ç´¯è®¡æ¬ è´¹</li>
                    <li><strong>æ°´ç”µæŠ„è¡¨ç®¡ç†</strong>ï¼šæ”¯æŒæŒ‰æˆ¿äº§æ€§è´¨è®¾ç½®ä¸åŒç”µè´¹å•ä»·</li>
                    <li><strong>æŠ¼é‡‘è‡ªåŠ¨æ‰£è´¹</strong>ï¼šæ°´è´¹ã€è£…ä¿®æŠ¼é‡‘å¯è‡ªåŠ¨æ‰£é™¤ç›¸å…³è´¹ç”¨</li>
                    <li><strong>æ¯æ—¥æ”¶å…¥è®°å½•</strong>ï¼šé—¨ç¦å¡ã€æ¶ˆé˜²æ”¾æ°´è´¹ç­‰ä¸´æ—¶æ”¶è´¹</li>
                    <li><strong>æ‰¹é‡è´¦å•ç”Ÿæˆ</strong>ï¼šæŒ‰æœˆæ‰¹é‡ä¸ºæ‰€æœ‰ä¸šä¸»ç”Ÿæˆæ ‡å‡†è´¦å•</li>
                </ul>
            </div>
            
            <div class="card">
                <h3>ğŸ“Š API æ¥å£æ¦‚è§ˆ</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>åŠŸèƒ½æ¨¡å—</th>
                            <th>API å‰ç¼€</th>
                            <th>ä¸»è¦åŠŸèƒ½</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>å°åŒºç®¡ç†</td>
                            <td>/api/v2/communities</td>
                            <td>å°åŒºã€æˆ¿äº§æ€§è´¨ã€è½¦ä½ç±»å‹ã€æ”¶è´¹æ ‡å‡†ç®¡ç†</td>
                        </tr>
                        <tr>
                            <td>è´¹ç”¨è®¡ç®—</td>
                            <td>/api/v2/fees</td>
                            <td>æ¬ è´¹è®¡ç®—ã€è´¦å•ç”Ÿæˆã€æ°´ç”µæŠ„è¡¨</td>
                        </tr>
                        <tr>
                            <td>æ”¯ä»˜ç®¡ç†</td>
                            <td>/api/v2/payments</td>
                            <td>æŠ¼é‡‘ç®¡ç†ã€æ¯æ—¥æ”¶å…¥ã€è´¹ç”¨è®°å½•</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- å°åŒºç®¡ç† -->
        <div id="communities" class="tab-content">
            <h2>ğŸ˜ï¸ å°åŒºç®¡ç†</h2>
            
            <div class="card">
                <h3>è·å–å°åŒºåˆ—è¡¨</h3>
                <button class="btn" onclick="getCommunities()">è·å–æ‰€æœ‰å°åŒº</button>
                <div id="communities-result" class="result-box" style="display: none;">
                    <pre id="communities-data"></pre>
                </div>
            </div>
            
            <div class="card">
                <h3>è·å–å°åŒºè¯¦æƒ…ï¼ˆåŒ…å«æ”¶è´¹æ ‡å‡†ï¼‰</h3>
                <div class="form-group">
                    <label>å°åŒºID</label>
                    <input type="number" id="community-id" placeholder="è¾“å…¥å°åŒºID" value="1">
                </div>
                <button class="btn" onclick="getCommunityDetails()">è·å–å°åŒºè¯¦æƒ…</button>
                <div id="community-details-result" class="result-box" style="display: none;">
                    <pre id="community-details-data"></pre>
                </div>
            </div>
            
            <div class="card">
                <h3>è®¾ç½®æ”¶è´¹æ ‡å‡†</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>å°åŒºID</label>
                        <input type="number" id="rate-community-id" value="1">
                    </div>
                    <div class="form-group">
                        <label>æ”¶è´¹é¡¹ç›®ID</label>
                        <select id="rate-fee-item-id">
                            <option value="1">ç‰©ä¸šè´¹</option>
                            <option value="2">ä¿æ´èƒ½è€—è´¹</option>
                            <option value="4">ç”µè´¹</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>æˆ¿äº§æ€§è´¨IDï¼ˆç‰©ä¸šè´¹/ç”µè´¹ç”¨ï¼‰</label>
                        <input type="number" id="rate-property-type-id" placeholder="ç•™ç©ºè¡¨ç¤ºé€šç”¨">
                    </div>
                    <div class="form-group">
                        <label>è½¦ä½ç±»å‹IDï¼ˆè½¦ä½ç®¡ç†è´¹ç”¨ï¼‰</label>
                        <input type="number" id="rate-parking-type-id" placeholder="ç•™ç©ºè¡¨ç¤ºé€šç”¨">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>å•ä»·ï¼ˆå…ƒï¼‰</label>
                        <input type="number" step="0.01" id="rate-unit-price" placeholder="ä¾‹å¦‚ï¼š3.0">
                    </div>
                    <div class="form-group">
                        <label>ç”Ÿæ•ˆæ—¥æœŸ</label>
                        <input type="date" id="rate-effective-date" value="2024-01-01">
                    </div>
                </div>
                <button class="btn btn-success" onclick="setFeeRate()">è®¾ç½®æ”¶è´¹æ ‡å‡†</button>
                <div id="set-rate-result" class="result-box" style="display: none;">
                    <pre id="set-rate-data"></pre>
                </div>
            </div>
        </div>
        
        <!-- æ¬ è´¹è®¡ç®— -->
        <div id="fee-calculation" class="tab-content">
            <h2>ğŸ’° æ¬ è´¹è®¡ç®—</h2>
            
            <div class="card">
                <h3>è®¡ç®—ä¸šä¸»æ¬ è´¹</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>ä¸šä¸»ID</label>
                        <input type="number" id="owner-id" placeholder="è¾“å…¥ä¸šä¸»ID" value="1">
                    </div>
                    <div class="form-group">
                        <label>è®¡ç®—æˆªæ­¢æ—¥æœŸ</label>
                        <input type="date" id="as-of-date" value="">
                    </div>
                </div>
                <button class="btn" onclick="calculateOutstandingFees()">è®¡ç®—æ¬ è´¹</button>
                <div id="outstanding-result" class="result-box" style="display: none;">
                    <pre id="outstanding-data"></pre>
                </div>
            </div>
            
            <div class="card">
                <h3>ä¸ºä¸šä¸»ç”Ÿæˆæ¬ è´¹è´¦å•</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>ä¸šä¸»ID</label>
                        <input type="number" id="bill-owner-id" placeholder="è¾“å…¥ä¸šä¸»ID" value="1">
                    </div>
                    <div class="form-group">
                        <label>è´¦å•åˆ°æœŸæ—¥æœŸ</label>
                        <input type="date" id="bill-due-date" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨</label>
                    <textarea id="bill-remark" placeholder="è´¦å•å¤‡æ³¨ä¿¡æ¯"></textarea>
                </div>
                <button class="btn btn-success" onclick="generateOutstandingBills()">ç”Ÿæˆæ¬ è´¹è´¦å•</button>
                <div id="generate-bills-result" class="result-box" style="display: none;">
                    <pre id="generate-bills-data"></pre>
                </div>
            </div>
        </div>
        
        <!-- è´¦å•ç”Ÿæˆ -->
        <div id="bill-generation" class="tab-content">
            <h2>ğŸ“„ æ‰¹é‡è´¦å•ç”Ÿæˆ</h2>
            
            <div class="card">
                <h3>æ‰¹é‡ç”Ÿæˆæœˆåº¦è´¦å•</h3>
                <p class="alert alert-info">
                    ä¸ºæŒ‡å®šå°åŒºçš„æ‰€æœ‰å·²äº¤ä»˜æˆ¿äº§ç”Ÿæˆå½“æœˆç‰©ä¸šè´¹å’Œè½¦ä½ç®¡ç†è´¹è´¦å•
                </p>
                <div class="form-row">
                    <div class="form-group">
                        <label>å°åŒºID</label>
                        <input type="number" id="monthly-community-id" placeholder="è¾“å…¥å°åŒºIDï¼Œç•™ç©ºè¡¨ç¤ºæ‰€æœ‰å°åŒº" value="1">
                    </div>
                    <div class="form-group">
                        <label>è´¦å•æœˆä»½</label>
                        <input type="month" id="monthly-bill-month" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label>è´¦å•åˆ°æœŸæ—¥æœŸ</label>
                    <input type="date" id="monthly-due-date" value="">
                </div>
                <button class="btn btn-warning" onclick="generateMonthlyBills()">æ‰¹é‡ç”Ÿæˆæœˆåº¦è´¦å•</button>
                <div id="monthly-bills-result" class="result-box" style="display: none;">
                    <pre id="monthly-bills-data"></pre>
                </div>
            </div>
            
            <div class="card">
                <h3>æŸ¥çœ‹è´¹ç”¨è®°å½•</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>å°åŒºID</label>
                        <input type="number" id="records-community-id" placeholder="ç•™ç©ºæŸ¥çœ‹æ‰€æœ‰">
                    </div>
                    <div class="form-group">
                        <label>ä¸šä¸»ID</label>
                        <input type="number" id="records-owner-id" placeholder="ç•™ç©ºæŸ¥çœ‹æ‰€æœ‰">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ç¼´è´¹çŠ¶æ€</label>
                        <select id="records-status">
                            <option value="">å…¨éƒ¨</option>
                            <option value="unpaid">æœªç¼´è´¹</option>
                            <option value="paid">å·²ç¼´è´¹</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ¯é¡µè®°å½•æ•°</label>
                        <select id="records-limit">
                            <option value="10">10æ¡</option>
                            <option value="20" selected>20æ¡</option>
                            <option value="50">50æ¡</option>
                        </select>
                    </div>
                </div>
                <button class="btn" onclick="getFeeRecords()">æŸ¥çœ‹è´¹ç”¨è®°å½•</button>
                <div id="fee-records-result" class="result-box" style="display: none;">
                    <pre id="fee-records-data"></pre>
                </div>
            </div>
        </div>
        
        <!-- æ°´ç”µç®¡ç† -->
        <div id="utilities" class="tab-content">
            <h2>ğŸ’§âš¡ æ°´ç”µç®¡ç†</h2>
            
            <div class="card">
                <h3>æŠ„æ°´è¡¨</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>æˆ¿äº§ID</label>
                        <input type="number" id="water-property-id" placeholder="è¾“å…¥æˆ¿äº§ID" value="1">
                    </div>
                    <div class="form-group">
                        <label>æŠ„è¡¨æ—¥æœŸ</label>
                        <input type="date" id="water-reading-date" value="">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>å½“å‰è¯»æ•°</label>
                        <input type="number" step="0.01" id="water-current-reading" placeholder="ä¾‹å¦‚ï¼š1250.5">
                    </div>
                    <div class="form-group">
                        <label>æ°´è´¹å•ä»·ï¼ˆå…ƒ/å¨ï¼‰</label>
                        <input type="number" step="0.01" id="water-unit-price" value="3.5">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>æŠ„è¡¨ç±»å‹</label>
                        <select id="water-reading-type">
                            <option value="monthly">æœˆåº¦æŠ„è¡¨</option>
                            <option value="special">ç‰¹æ®ŠæŠ„è¡¨</option>
                            <option value="move_in">å…¥ä½æŠ„è¡¨</option>
                            <option value="move_out">é€€ç§ŸæŠ„è¡¨</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æŠ„è¡¨å‘˜</label>
                        <input type="text" id="water-reader" placeholder="æŠ„è¡¨å‘˜å§“å">
                    </div>
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨</label>
                    <textarea id="water-remark" placeholder="æŠ„è¡¨å¤‡æ³¨"></textarea>
                </div>
                <button class="btn btn-success" onclick="createWaterReading()">æäº¤æ°´è¡¨è¯»æ•°</button>
                <div id="water-reading-result" class="result-box" style="display: none;">
                    <pre id="water-reading-data"></pre>
                </div>
            </div>
            
            <div class="card">
                <h3>æŠ„ç”µè¡¨</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>æˆ¿äº§ID</label>
                        <input type="number" id="electricity-property-id" placeholder="è¾“å…¥æˆ¿äº§ID" value="1">
                    </div>
                    <div class="form-group">
                        <label>æŠ„è¡¨æ—¥æœŸ</label>
                        <input type="date" id="electricity-reading-date" value="">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>å½“å‰è¯»æ•°</label>
                        <input type="number" step="0.01" id="electricity-current-reading" placeholder="ä¾‹å¦‚ï¼š8520.8">
                    </div>
                    <div class="form-group">
                        <label>é¢„ä»˜è´¹ä½™é¢ï¼ˆå…ƒï¼‰</label>
                        <input type="number" step="0.01" id="electricity-prepaid-balance" placeholder="é¢„ä»˜è´¹ä½™é¢" value="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>æŠ„è¡¨ç±»å‹</label>
                        <select id="electricity-reading-type">
                            <option value="monthly">æœˆåº¦æŠ„è¡¨</option>
                            <option value="special">ç‰¹æ®ŠæŠ„è¡¨</option>
                            <option value="move_in">å…¥ä½æŠ„è¡¨</option>
                            <option value="move_out">é€€ç§ŸæŠ„è¡¨</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æŠ„è¡¨å‘˜</label>
                        <input type="text" id="electricity-reader" placeholder="æŠ„è¡¨å‘˜å§“å">
                    </div>
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨</label>
                    <textarea id="electricity-remark" placeholder="æŠ„è¡¨å¤‡æ³¨"></textarea>
                </div>
                <button class="btn btn-success" onclick="createElectricityReading()">æäº¤ç”µè¡¨è¯»æ•°</button>
                <div id="electricity-reading-result" class="result-box" style="display: none;">
                    <pre id="electricity-reading-data"></pre>
                </div>
            </div>
        </div>
        
        <!-- æ¯æ—¥æ”¶å…¥ -->
        <div id="daily-income" class="tab-content">
            <h2>ğŸ“Š æ¯æ—¥æ”¶å…¥ç®¡ç†</h2>
            
            <div class="card">
                <h3>é—¨ç¦å¡æ”¶è´¹ï¼ˆå¿«æ·æ–¹å¼ï¼‰</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>å°åŒºID</label>
                        <input type="number" id="card-community-id" placeholder="è¾“å…¥å°åŒºID" value="1">
                    </div>
                    <div class="form-group">
                        <label>æˆ¿äº§IDï¼ˆå¯é€‰ï¼‰</label>
                        <input type="number" id="card-property-id" placeholder="å…³è”æˆ¿äº§ID">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>å¡ç‰‡æ•°é‡</label>
                        <input type="number" id="card-count" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label>å•ä»·ï¼ˆå…ƒ/å¼ ï¼‰</label>
                        <input type="number" step="0.01" id="card-unit-price" value="15">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>æ”¶è´¹å‘˜</label>
                        <input type="text" id="card-collector" placeholder="æ”¶è´¹å‘˜å§“å">
                    </div>
                    <div class="form-group">
                        <label>å¤‡æ³¨</label>
                        <input type="text" id="card-remark" placeholder="é¢å¤–å¤‡æ³¨">
                    </div>
                </div>
                <button class="btn btn-success" onclick="addAccessCardFee()">è®°å½•é—¨ç¦å¡æ”¶è´¹</button>
                <div id="card-fee-result" class="result-box" style="display: none;">
                    <pre id="card-fee-data"></pre>
                </div>
            </div>
            
            <div class="card">
                <h3>æ¶ˆé˜²æ”¾æ°´è´¹ï¼ˆå¿«æ·æ–¹å¼ï¼‰</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>å°åŒºID</label>
                        <input type="number" id="fire-community-id" placeholder="è¾“å…¥å°åŒºID" value="1">
                    </div>
                    <div class="form-group">
                        <label>æˆ¿äº§ID</label>
                        <input type="number" id="fire-property-id" placeholder="å…³è”æˆ¿äº§ID">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>è´¹ç”¨ï¼ˆå…ƒï¼‰</label>
                        <input type="number" step="0.01" id="fire-unit-price" value="20">
                    </div>
                    <div class="form-group">
                        <label>æ”¶è´¹å‘˜</label>
                        <input type="text" id="fire-collector" placeholder="æ”¶è´¹å‘˜å§“å">
                    </div>
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨</label>
                    <input type="text" id="fire-remark" placeholder="æ¶ˆé˜²æ”¾æ°´å¤‡æ³¨">
                </div>
                <button class="btn btn-warning" onclick="addFireWaterFee()">è®°å½•æ¶ˆé˜²æ”¾æ°´è´¹</button>
                <div id="fire-fee-result" class="result-box" style="display: none;">
                    <pre id="fire-fee-data"></pre>
                </div>
            </div>
            
            <div class="card">
                <h3>æŸ¥çœ‹æ¯æ—¥æ”¶å…¥è®°å½•</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>å°åŒºID</label>
                        <input type="number" id="income-community-id" placeholder="ç•™ç©ºæŸ¥çœ‹æ‰€æœ‰">
                    </div>
                    <div class="form-group">
                        <label>æ”¶å…¥ç±»å‹</label>
                        <select id="income-type">
                            <option value="">å…¨éƒ¨ç±»å‹</option>
                            <option value="é—¨ç¦å¡è´¹">é—¨ç¦å¡è´¹</option>
                            <option value="æ¶ˆé˜²æ”¾æ°´è´¹">æ¶ˆé˜²æ”¾æ°´è´¹</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>å¼€å§‹æ—¥æœŸ</label>
                        <input type="date" id="income-start-date">
                    </div>
                    <div class="form-group">
                        <label>ç»“æŸæ—¥æœŸ</label>
                        <input type="date" id="income-end-date">
                    </div>
                </div>
                <button class="btn" onclick="getDailyIncomeRecords()">æŸ¥çœ‹æ”¶å…¥è®°å½•</button>
                <div id="income-records-result" class="result-box" style="display: none;">
                    <pre id="income-records-data"></pre>
                </div>
            </div>
        </div>
        
        <!-- æŠ¼é‡‘ç®¡ç† -->
        <div id="deposits" class="tab-content">
            <h2>ğŸ’³ æŠ¼é‡‘ç®¡ç†</h2>
            
            <div class="card">
                <h3>åˆ›å»ºæŠ¼é‡‘è®°å½•</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>æˆ¿äº§ID</label>
                        <input type="number" id="deposit-property-id" placeholder="è¾“å…¥æˆ¿äº§ID" value="1">
                    </div>
                    <div class="form-group">
                        <label>æŠ¼é‡‘ç±»å‹</label>
                        <select id="deposit-type">
                            <option value="æ°´è´¹æŠ¼é‡‘">æ°´è´¹æŠ¼é‡‘</option>
                            <option value="è£…ä¿®æŠ¼é‡‘">è£…ä¿®æŠ¼é‡‘</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>æŠ¼é‡‘é‡‘é¢ï¼ˆå…ƒï¼‰</label>
                        <input type="number" step="0.01" id="deposit-amount" placeholder="ä¾‹å¦‚ï¼š200.00">
                    </div>
                    <div class="form-group">
                        <label>ç¼´è´¹æ—¥æœŸ</label>
                        <input type="date" id="deposit-paid-date" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label>è‡ªåŠ¨æ‰£è´¹</label>
                    <select id="deposit-auto-deduct">
                        <option value="false">å¦</option>
                        <option value="true">æ˜¯</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨</label>
                    <textarea id="deposit-remark" placeholder="æŠ¼é‡‘å¤‡æ³¨"></textarea>
                </div>
                <button class="btn btn-success" onclick="createDepositRecord()">åˆ›å»ºæŠ¼é‡‘è®°å½•</button>
                <div id="create-deposit-result" class="result-box" style="display: none;">
                    <pre id="create-deposit-data"></pre>
                </div>
            </div>
            
            <div class="card">
                <h3>æŸ¥çœ‹æŠ¼é‡‘è®°å½•</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>ä¸šä¸»ID</label>
                        <input type="number" id="view-deposit-owner-id" placeholder="ç•™ç©ºæŸ¥çœ‹æ‰€æœ‰">
                    </div>
                    <div class="form-group">
                        <label>æŠ¼é‡‘ç±»å‹</label>
                        <select id="view-deposit-type">
                            <option value="">å…¨éƒ¨ç±»å‹</option>
                            <option value="æ°´è´¹æŠ¼é‡‘">æ°´è´¹æŠ¼é‡‘</option>
                            <option value="è£…ä¿®æŠ¼é‡‘">è£…ä¿®æŠ¼é‡‘</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>æŠ¼é‡‘çŠ¶æ€</label>
                    <select id="view-deposit-status">
                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                        <option value="active">æœ‰æ•ˆ</option>
                        <option value="depleted">è€—å°½</option>
                        <option value="refunded">å·²é€€è¿˜</option>
                    </select>
                </div>
                <button class="btn" onclick="getDepositRecords()">æŸ¥çœ‹æŠ¼é‡‘è®°å½•</button>
                <div id="view-deposits-result" class="result-box" style="display: none;">
                    <pre id="view-deposits-data"></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000';
        
        // è®¾ç½®é»˜è®¤æ—¥æœŸ
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const nextMonthStr = nextMonth.toISOString().split('T')[0];
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸ
            document.getElementById('as-of-date').value = today;
            document.getElementById('bill-due-date').value = nextMonthStr;
            document.getElementById('monthly-due-date').value = nextMonthStr;
            document.getElementById('water-reading-date').value = today;
            document.getElementById('electricity-reading-date').value = today;
            document.getElementById('deposit-paid-date').value = today;
            
            // è®¾ç½®é»˜è®¤æœˆä»½
            const currentMonth = new Date().toISOString().slice(0, 7);
            document.getElementById('monthly-bill-month').value = currentMonth;
        });
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabName).classList.add('active');
            
            // æ¿€æ´»å¯¹åº”çš„æŒ‰é’®
            event.target.classList.add('active');
        }
        
        // é€šç”¨ API è°ƒç”¨å‡½æ•°
        async function apiCall(url, options = {}) {
            try {
                showLoading(options.resultId);
                const response = await fetch(API_BASE + url, {
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    ...options
                });
                const data = await response.json();
                showResult(options.resultId, data);
                return data;
            } catch (error) {
                showResult(options.resultId, { error: error.message });
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
            }
        }
        
        function showLoading(resultId) {
            if (resultId) {
                const resultBox = document.getElementById(resultId);
                const dataElement = document.getElementById(resultId.replace('-result', '-data'));
                resultBox.style.display = 'block';
                dataElement.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            }
        }
        
        function showResult(resultId, data) {
            if (resultId) {
                const resultBox = document.getElementById(resultId);
                const dataElement = document.getElementById(resultId.replace('-result', '-data'));
                resultBox.style.display = 'block';
                dataElement.textContent = JSON.stringify(data, null, 2);
            }
        }
        
        // å°åŒºç®¡ç†ç›¸å…³å‡½æ•°
        async function getCommunities() {
            await apiCall('/api/v2/communities', {
                resultId: 'communities-result'
            });
        }
        
        async function getCommunityDetails() {
            const communityId = document.getElementById('community-id').value;
            if (!communityId) {
                alert('è¯·è¾“å…¥å°åŒºID');
                return;
            }
            
            await apiCall(`/api/v2/communities/${communityId}`, {
                resultId: 'community-details-result'
            });
        }
        
        async function setFeeRate() {
            const data = {
                community_id: parseInt(document.getElementById('rate-community-id').value),
                fee_item_id: parseInt(document.getElementById('rate-fee-item-id').value),
                unit_price: parseFloat(document.getElementById('rate-unit-price').value),
                effective_date: document.getElementById('rate-effective-date').value
            };
            
            const propertyTypeId = document.getElementById('rate-property-type-id').value;
            const parkingTypeId = document.getElementById('rate-parking-type-id').value;
            
            if (propertyTypeId) data.property_type_id = parseInt(propertyTypeId);
            if (parkingTypeId) data.parking_type_id = parseInt(parkingTypeId);
            
            await apiCall('/api/v2/communities/fee-rates', {
                method: 'POST',
                body: JSON.stringify(data),
                resultId: 'set-rate-result'
            });
        }
        
        // æ¬ è´¹è®¡ç®—ç›¸å…³å‡½æ•°
        async function calculateOutstandingFees() {
            const ownerId = document.getElementById('owner-id').value;
            const asOfDate = document.getElementById('as-of-date').value;
            
            if (!ownerId) {
                alert('è¯·è¾“å…¥ä¸šä¸»ID');
                return;
            }
            
            let url = `/api/v2/fees/outstanding/${ownerId}`;
            if (asOfDate) {
                url += `?as_of_date=${asOfDate}`;
            }
            
            await apiCall(url, {
                resultId: 'outstanding-result'
            });
        }
        
        async function generateOutstandingBills() {
            const ownerId = document.getElementById('bill-owner-id').value;
            const dueDate = document.getElementById('bill-due-date').value;
            const remark = document.getElementById('bill-remark').value;
            
            if (!ownerId) {
                alert('è¯·è¾“å…¥ä¸šä¸»ID');
                return;
            }
            
            const data = {
                due_date: dueDate,
                remark: remark
            };
            
            await apiCall(`/api/v2/fees/generate-outstanding/${ownerId}`, {
                method: 'POST',
                body: JSON.stringify(data),
                resultId: 'generate-bills-result'
            });
        }
        
        // è´¦å•ç”Ÿæˆç›¸å…³å‡½æ•°
        async function generateMonthlyBills() {
            const communityId = document.getElementById('monthly-community-id').value;
            const billMonth = document.getElementById('monthly-bill-month').value;
            const dueDate = document.getElementById('monthly-due-date').value;
            
            if (!billMonth || !dueDate) {
                alert('è¯·å¡«å†™è´¦å•æœˆä»½å’Œåˆ°æœŸæ—¥æœŸ');
                return;
            }
            
            const data = {
                bill_month: billMonth,
                due_date: dueDate
            };
            
            if (communityId) {
                data.community_id = parseInt(communityId);
            }
            
            await apiCall('/api/v2/fees/generate-monthly', {
                method: 'POST',
                body: JSON.stringify(data),
                resultId: 'monthly-bills-result'
            });
        }
        
        async function getFeeRecords() {
            const params = new URLSearchParams();
            
            const communityId = document.getElementById('records-community-id').value;
            const ownerId = document.getElementById('records-owner-id').value;
            const status = document.getElementById('records-status').value;
            const limit = document.getElementById('records-limit').value;
            
            if (communityId) params.append('community_id', communityId);
            if (ownerId) params.append('owner_id', ownerId);
            if (status) params.append('status', status);
            if (limit) params.append('limit', limit);
            
            await apiCall(`/api/v2/payments/records?${params.toString()}`, {
                resultId: 'fee-records-result'
            });
        }
        
        // æ°´ç”µç®¡ç†ç›¸å…³å‡½æ•°
        async function createWaterReading() {
            const data = {
                property_id: parseInt(document.getElementById('water-property-id').value),
                reading_date: document.getElementById('water-reading-date').value,
                current_reading: parseFloat(document.getElementById('water-current-reading').value),
                unit_price: parseFloat(document.getElementById('water-unit-price').value),
                reading_type: document.getElementById('water-reading-type').value,
                reader: document.getElementById('water-reader').value,
                remark: document.getElementById('water-remark').value
            };
            
            await apiCall('/api/v2/fees/water-reading', {
                method: 'POST',
                body: JSON.stringify(data),
                resultId: 'water-reading-result'
            });
        }
        
        async function createElectricityReading() {
            const data = {
                property_id: parseInt(document.getElementById('electricity-property-id').value),
                reading_date: document.getElementById('electricity-reading-date').value,
                current_reading: parseFloat(document.getElementById('electricity-current-reading').value),
                reading_type: document.getElementById('electricity-reading-type').value,
                prepaid_balance: parseFloat(document.getElementById('electricity-prepaid-balance').value || 0),
                reader: document.getElementById('electricity-reader').value,
                remark: document.getElementById('electricity-remark').value
            };
            
            await apiCall('/api/v2/fees/electricity-reading', {
                method: 'POST',
                body: JSON.stringify(data),
                resultId: 'electricity-reading-result'
            });
        }
        
        // æ¯æ—¥æ”¶å…¥ç›¸å…³å‡½æ•°
        async function addAccessCardFee() {
            const data = {
                community_id: parseInt(document.getElementById('card-community-id').value),
                card_count: parseInt(document.getElementById('card-count').value),
                unit_price: parseFloat(document.getElementById('card-unit-price').value),
                collector: document.getElementById('card-collector').value,
                remark: document.getElementById('card-remark').value
            };
            
            const propertyId = document.getElementById('card-property-id').value;
            if (propertyId) data.property_id = parseInt(propertyId);
            
            await apiCall('/api/v2/payments/daily-income/access-card', {
                method: 'POST',
                body: JSON.stringify(data),
                resultId: 'card-fee-result'
            });
        }
        
        async function addFireWaterFee() {
            const data = {
                community_id: parseInt(document.getElementById('fire-community-id').value),
                property_id: parseInt(document.getElementById('fire-property-id').value),
                unit_price: parseFloat(document.getElementById('fire-unit-price').value),
                collector: document.getElementById('fire-collector').value,
                remark: document.getElementById('fire-remark').value
            };
            
            await apiCall('/api/v2/payments/daily-income/fire-water', {
                method: 'POST',
                body: JSON.stringify(data),
                resultId: 'fire-fee-result'
            });
        }
        
        async function getDailyIncomeRecords() {
            const params = new URLSearchParams();
            
            const communityId = document.getElementById('income-community-id').value;
            const incomeType = document.getElementById('income-type').value;
            const startDate = document.getElementById('income-start-date').value;
            const endDate = document.getElementById('income-end-date').value;
            
            if (communityId) params.append('community_id', communityId);
            if (incomeType) params.append('income_type', incomeType);
            if (startDate) params.append('start_date', startDate);
            if (endDate) params.append('end_date', endDate);
            
            await apiCall(`/api/v2/payments/daily-income?${params.toString()}`, {
                resultId: 'income-records-result'
            });
        }
        
        // æŠ¼é‡‘ç®¡ç†ç›¸å…³å‡½æ•°
        async function createDepositRecord() {
            const data = {
                property_id: parseInt(document.getElementById('deposit-property-id').value),
                deposit_type: document.getElementById('deposit-type').value,
                amount: parseFloat(document.getElementById('deposit-amount').value),
                paid_date: document.getElementById('deposit-paid-date').value,
                auto_deduct: document.getElementById('deposit-auto-deduct').value === 'true',
                remark: document.getElementById('deposit-remark').value
            };
            
            await apiCall('/api/v2/payments/deposits', {
                method: 'POST',
                body: JSON.stringify(data),
                resultId: 'create-deposit-result'
            });
        }
        
        async function getDepositRecords() {
            const params = new URLSearchParams();
            
            const ownerId = document.getElementById('view-deposit-owner-id').value;
            const depositType = document.getElementById('view-deposit-type').value;
            const status = document.getElementById('view-deposit-status').value;
            
            if (ownerId) params.append('owner_id', ownerId);
            if (depositType) params.append('deposit_type', depositType);
            if (status) params.append('status', status);
            
            await apiCall(`/api/v2/payments/deposits?${params.toString()}`, {
                resultId: 'view-deposits-result'
            });
        }
    </script>
</body>
</html>